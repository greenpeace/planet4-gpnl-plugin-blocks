{"version":3,"sources":["onload.js"],"names":["getUrlVars","hash","vars","hashes","location","href","split","slice","window","indexOf","i","length","push","getFormObj","formObj","name","inputs","el","serializeArray","$","each","input","value","toggleDisable","prop","cardflip","element","parent","parentNode","nextElementSibling","card","toggleClass","toggle","find","css","flip_positionattribute","one","off","document","ready","opt","url_cg","referrer","isfacebook","clangct","prefillByGuid","type","form","XMLHttpRequest","query_id","requestValue","xmlhttp","tellerCode","open","sr","response","onreadystatechange","readyState","email","status","responseXML","getElementsByTagName","firstChild","nodeValue","showCounter","Number","res","naam","val","setRequestHeader","num_responses","formwrapper","counter_min","width","perc_slider","show","opacity","Math","round","counter_max","animate","html","toLocaleString","counter_text","fadeIn","send","undefined","ajax","url","dataType","hide","keyup","test","this","mail","encodeURIComponent","complete","data","responseText","includes","istwitter","form_config","analytics_campaign","countermin","countermax","countertext","ajaxurl","action","success","nonce","error","console","log","cardback","append"],"mappings":"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","file":"../onload.js","sourcesContent":["$(document).ready(function() {\n\n  // Hide the consentbox if the opt=in url var is set. (this is for set for ie mailings)\n  var opt=getUrlVars()['opt'];\n  var url_cg = getUrlVars()['cg'];\n  var isfacebook = document.referrer.indexOf('facebook') !== -1;\n  var istwitter = document.referrer.indexOf('twitter') !== -1;\n\n  let clangct=getUrlVars()['clangct'];\n\n  if(clangct != undefined){\n    $.ajax({\n      url: '/wp-content/plugins/planet4-gpnl-plugin-blocks/includes/assets/js/clang-landing.js?clangct='+clangct,\n      dataType: 'script',\n    });\n  }\n\n  if(opt!= undefined && $('.optin').length != 0 && opt=='in'){\n    $('.optin').hide();\n    $('.gpnl-petition-checkbox').prop( 'checked', true );\n\n    // Here we check if we know the mail being entered if the opt=in var is set.\n    // If we don't know the entered mail we should display the consentbox\n    $( 'input[name=\\'mail\\']' ).keyup(function() {\n      // First loosely check if the value in the mailinput is indeed a mailadress, if it indeed is, we pass it onto the database checker\n      // eslint-disable-next-line\n      var mailRegex = /^(([^<>()\\[\\]\\.,;:\\s@\\\"]+(\\.[^<>()\\[\\]\\.,;:\\s@\\\"]+)*)|(\\\".+\\\"))@(([^<>()[\\]\\.,;:\\s@\\\"]+\\.)+[^<>()[\\]\\.,;:\\s@\\\"]{2,})$/i;\n      if (mailRegex.test(this.value)) {\n        let mail = encodeURIComponent(this.value);\n        $.ajax({\n          type: 'GET',\n          url: 'https://secure.greenpeacephp.nl/kenikdeze.php?mail=' + mail,\n          complete: function(data) {\n            // If we do not know the email, we display the consentbox again\n            if (data.responseText.includes('false')) {\n              $('.optin').show();\n              $('.gpnl-petition-checkbox').prop( 'checked', false );\n            }\n          }\n        });\n      }\n    });\n\n    if ( !(istwitter || isfacebook)   ){\n      prefillByGuid('prefill', this);\n    }\n  }\n\n  $('.gpnl-petitionform').each(function(){\n    let form = this;\n    let post_form_value = getFormObj(form);\n    let form_id = post_form_value['form_id'];\n    let form_config = 'petition_form_object_' + form_id;\n    this.tellerCode = window[form_config].analytics_campaign;\n    this.counter_min = Number(window[form_config].countermin);\n    this.counter_max = Number(window[form_config].countermax);\n    this.counter_text = window[form_config].countertext;\n\n    let form_disabled = $(form).find(':submit').prop('disabled');\n\n    // Check if the submit button is disabled.\n    // FF seems to remember btn state from last request, which might break the form.\n    if ( ! form_disabled ) {\n      toggleDisable($(form).find(':submit'));\n    }\n\n    $.ajax({\n      type:    'POST',\n      url:     window['p4_vars'].ajaxurl,\n      data:    {'action' : 'request_id'},\n      success: function(response) {\n        // eslint-disable-next-line no-console\n        window[form_config].nonce = response.data.nonce;\n        toggleDisable($(this).find(':submit'));\n      },\n      error: function(){\n        // If the backend sends an error, hide the thank element and show an error urging to try again\n        // eslint-disable-next-line no-console\n        console.log('o_o');\n        var cardback = $(form.parentNode.nextElementSibling);\n        cardback.find('*').hide('');\n        cardback.append('<p>Sorry, er gaat momenteel iets fout, probeer het nu of later opnieuw.</p>');\n        cardback.append(\n          '<a href=\\''+window.location.href +'\\' class=\"btn btn-primary btn-block\"' +\n          '\">Probeer opnieuw</a>');\n        cardflip(form);\n      }\n    });\n\n\n    prefillByGuid('teller', this);\n  });\n\n  function prefillByGuid(type, form){\n    var xmlhttp = new XMLHttpRequest();\n    var query_id = '';\n    var requestValue = '';\n    // waar gaat het om? Een teller of een prefill?\n    if (type === 'prefill'){\n      query_id = 'GET_FIRST_NAME_EMAIL';\n      requestValue = url_cg;\n    } else if (type === 'teller'){\n      query_id = 'CAMP_TTL_PETITIONS';\n      requestValue = form.tellerCode;\n    }\n    xmlhttp.open('POST', 'https://www.mygreenpeace.nl/GPN.WebServices/WIDSService.asmx', true);\n    // build SOAP request\n    var sr = '<'+'?'+'xml version=\"1.0\" encoding=\"utf-8\"?>' +\n    '<soap:Envelope xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\" xmlns:soap=\"http://schemas.xmlsoap.org/soap/envelope/\">' +\n    '  <soap:Body>' +\n    '    <WatIsDestand xmlns=\"http://www.mygreenpeace.nl/GPN.WebServices/\">' +\n    '      <queryId>'+query_id+'</queryId>' +\n    '      <requestValue>'+requestValue+'</requestValue>' +\n    '    </WatIsDestand>' +\n    '  </soap:Body>' +\n    '</soap:Envelope>';\n\n    xmlhttp.onreadystatechange = function () {\n      if (xmlhttp.readyState === 4 && xmlhttp.status === 200){ // 200 = OK\n        var response = xmlhttp.responseXML.getElementsByTagName('WatIsDestandResult')[0].firstChild.nodeValue;\n        if (response!==''){\n          var res = response.split('|');\n          // waar gaat het om? Een teller of een prefill\n          if (type === 'prefill'){\n            var naam = res[0];\n            $(form).find('input[name=\\'name\\']').val(naam);\n            var email = res[1];\n            $(form).find('input[name=\\'mail\\']').val(email);\n          } else if (type === 'teller'){\n            showCounter(Number(res[0]), form);\n          }\n        }\n      }\n    };\n    // Send the POST request\n    xmlhttp.setRequestHeader('Content-Type', 'text/xml');\n    xmlhttp.setRequestHeader('SOAPAction', 'http://www.mygreenpeace.nl/GPN.WebServices/WatIsDestand');\n    xmlhttp.send(sr);\n    // send request\n  }\n\n  // TODO add language preference detection for better formatting of numbers\n  function showCounter(num_responses, form){\n    let formwrapper = form.parentNode;\n    if (num_responses >= form.counter_min){\n      $(formwrapper).find('.counter').show();\n      var perc_slider = Math.round(100 *(num_responses / form.counter_max));\n\n      if (num_responses >= form.counter_max) {\n        perc_slider = 100;\n      }\n\n      $(formwrapper).find('.counter__slider').animate({width: perc_slider+'%', opacity: 1}, 2000, 'easeInOutCubic');\n      $(formwrapper).find('.counter__gettext').html(num_responses.toLocaleString('nl-NL') +' '+form.counter_text);\n      $(formwrapper).find('.counter__text').fadeIn(2000);\n    }\n  }\n\n  //  try to get an response from whatsapp, else hide the whatsappbutton\n  //  ATM not working because ajax doesn't support custom schemes...\n  // TODO Find different way of determining whatsapp support\n  // $.ajax({\n  //   type: 'HEAD',\n  //   url: 'whatsapp://send?text=text=Hello%20World!',\n  //   success: function() {\n  //     // window.location='whatsapp://send?text=text=Hello%20World!';\n  //   },\n  //   error: function() {\n  //     $('.gpnl-share-whatsapp').toggle();\n  //   }\n  // });\n});\n\nfunction getUrlVars(){\n  var vars = [],\n    hash;\n  var uri = window.location.href.split('#')[0];\n  var hashes = uri.slice(window.location.href.indexOf('?') + 1).split('&');\n  for(var i = 0; i < hashes.length; i++){\n    hash = hashes[i].split('=');\n    vars.push(hash[0]);\n    vars[hash[0]] = hash[1];\n  }\n  return vars;\n}\n\n// Get the key+value from the input fields in the form\nfunction getFormObj(el) {\n  var formObj = {};\n  var inputs = $(el).serializeArray();\n  $.each(inputs, function (i, input) {\n    formObj[input.name] = input.value;\n  });\n  return formObj;\n}\n\n// Toggle the disabled state on form elements\nfunction toggleDisable(el) {\n  el.prop('disabled', !el.prop('disabled'));\n\n}\n\n// toggle the flipped class for the card parent\nfunction cardflip(el) {\n  let element = $(el);\n  let parent =  el.parentNode;\n  let card = $(el.parentNode.parentNode);\n\n  // first hide the signing button\n  $(element.find('.signBtn')).toggle();\n  $(element.find('.policies')).toggle();\n  // then cardflip the position attribute on the front and back of the card to support different lengths front and back\n  $(parent.nextElementSibling).css( 'position', flip_positionattribute(parent.nextElementSibling));\n  $(parent).css( 'position', flip_positionattribute(parent));\n  // then cardflip the card\n  card.toggleClass('flipped');\n\n  // after animation hide the front\n  card.one('webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend',\n    function() {\n      $(parent).toggle();\n      card.off('webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend');\n    });\n\n}\n\nfunction flip_positionattribute (el){\n  return $(el).css('position') === 'absolute' ? 'relative' : 'absolute';\n}\n"]}