{"version":3,"sources":["gpnl-election.js"],"names":["element","el","parent","card","parentNode","$","each","inputs","i","input","formObj","name","value","toggleClass","prop","cardflip","flip_positionattribute","css","toggle","find","nextElementSibling","global_config","window","one","console","off","apHost","platform","dataLayer","_apOrderValue","_apOrderNumber","_apRef","conv_campaign","analytics_campaign","conv_action","conv_label","unescape","script","type","socialBlueDeDuplicate","email","phone","apref","document","location","protocol","apSrc","append","length","hash","hashes","vars","createElement","src","getElementsByTagName","appendChild","totalVotes","numOptions","modalCounterId","modalCounter","data","slice","href","indexOf","split","counter_config","num_responses","counter","showCounter","opacity","fadeIn","modal","count","perc_slider","Math","round","show","animate","width","html","xmlhttp","query_id","requestValue","prefillByGuid","form","config","XMLHttpRequest","sr","onreadystatechange","url_cg","response","tellerCode","open","counter_min","readyState","status","responseXML","firstChild","nodeValue","res","naam","val","setRequestHeader","Number","text","send","on","event","id","relatedTarget","button","this","title","subtitle","description","mcode","ready","halfSize","floor","slick","infinite","mobileFirst","slidesToShow","slidesToScroll","arrows","dots","centerMode","centerPadding","initialSlide","responsive","breakpoint","settings","opt","getUrlVars","isfacebook","referrer","clangct","undefined","ajax","url","dataType","hide","keyup","test","mail","encodeURIComponent","complete","responseText","includes","istwitter","hideresults","petition_form_element","post_form_value","getFormObj","ad_campaign","toggleDisable","action","nonce","consent","optin","phoneFilled","success","phonetmp","mailtmp","push","phoneResult","mailResult","campaign","emailKnown","telKnown","clang","conversion","track","cardback","error","log","serializeArray"],"mappings":"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","file":"../gpnl-election.js","sourcesContent":["// Vul het modal met de juiste data\n$('#electionModal').on('show.bs.modal', function (event) {\n  var button = $(event.relatedTarget);\n  var id = button.data('id');\n  var modal = $(this);\n  var config = window['election_object_' + id];\n\n  modal.find('.modal-title').text('Stem op ' + config.title);\n  modal.find('.modal-subtitle').text(config.subtitle);\n  modal.find('.modal-body').text( config.description );\n  modal.find('input[name=\\'form_id\\']').val(id);\n  modal.find('input[name=\\'marketingcode\\']').val(config.mcode);\n  modal.find('.counter').data('counter', id);\n});\n\n$(document).ready(function() {\n  // convert an element to slider using slick js\n  function slickify(element) {\n    let numOptions = $('#electionModal').data('num');\n    let halfSize = Math.floor(numOptions / 2);\n    $(element).slick({\n      infinite: false,\n      mobileFirst: true,\n      slidesToShow: 1,\n      slidesToScroll: 1,\n      arrows: true,\n      dots: true,\n      centerMode: true,\n      centerPadding: '50px',\n      initialSlide: halfSize,\n      responsive: [\n        {\n          breakpoint: 992,\n          settings: {slidesToShow: numOptions}\n        },\n        {\n          breakpoint: 768,\n          settings: {slidesToShow: 3}\n        },\n        {\n          breakpoint: 576,\n          settings: {slidesToShow: 2}\n        }\n      ]\n    });\n  }\n\n  slickify('.election-options');\n\n  // Hide the consentbox if the opt=in url var is set. (this is for set for ie mailings)\n  var opt = getUrlVars()['opt'];\n  this.url_cg = getUrlVars()['cg'];\n  var isfacebook = document.referrer.indexOf('facebook') !== -1;\n  var istwitter = document.referrer.indexOf('twitter') !== -1;\n\n  let clangct = getUrlVars()['clangct'];\n\n  if (clangct != undefined) {\n    $.ajax({\n      url: '/wp-content/plugins/planet4-gpnl-plugin-blocks/includes/assets/js/clang-landing.js?clangct=' + clangct,\n      dataType: 'script',\n    });\n  }\n\n  if (opt != undefined && $('.optin').length != 0 && opt == 'in') {\n    $('.optin').hide();\n    $('.gpnl-petition-checkbox').prop('checked', true);\n\n    // Here we check if we know the mail being entered if the opt=in var is set.\n    // If we don't know the entered mail we should display the consentbox\n    $('input[name=\\'mail\\']').keyup(function () {\n      // First loosely check if the value in the mailinput is indeed a mailadress, if it indeed is, we pass it onto the database checker\n      // eslint-disable-next-line\n      var mailRegex = /^(([^<>()\\[\\]\\.,;:\\s@\\\"]+(\\.[^<>()\\[\\]\\.,;:\\s@\\\"]+)*)|(\\\".+\\\"))@(([^<>()[\\]\\.,;:\\s@\\\"]+\\.)+[^<>()[\\]\\.,;:\\s@\\\"]{3,})$/i;\n      if (mailRegex.test(this.value)) {\n        let mail = encodeURIComponent(this.value);\n        $.ajax({\n          type: 'GET',\n          url: 'https://secure.greenpeacephp.nl/kenikdeze.php?mail=' + mail,\n          complete: function (data) {\n            // If we do not know the email, we display the consentbox again\n            if (data.responseText.includes('false')) {\n              $('.optin').show();\n              $('.gpnl-petition-checkbox').prop('checked', false);\n            }\n          }\n        });\n      }\n    });\n\n    if (!(istwitter || isfacebook) && this.url_cg != undefined) {\n      prefillByGuid('prefill', this);\n    }\n  }\n\n  let global_config = window['election_object'];\n  // totaal aantal stemmen opvragen\n  let form = {\n    tellerCode: global_config.analytics_campaign,\n    type: 'total'\n  };\n  prefillByGuid('teller', form);\n\n  if (!Number(global_config.hideresults)) {\n    // opvragen stemmen per opties (verborgen tot na stemmen)\n    var numOptions = $('#electionModal').data('num');\n    for (let i = 1; i <= numOptions; i++) {\n      var counter = {};\n      var counter_config = window['election_object_' + i];\n      counter.id = i;\n      counter.type = 'subtotal';\n      counter.tellerCode = counter_config.mcode;\n      counter.config = counter_config;\n      prefillByGuid('teller', counter);\n    }\n  }\n});\n\n\n$('.gpnl-petitionform').on('submit', function () {\n\n\n  var petition_form_element = this;\n  // Get the  parameter from the petition form and add the action and CSRF protection\n  var post_form_value = getFormObj(petition_form_element);\n  var global_config = window['election_object'];\n\n\n  post_form_value.action = 'petition_form_process';\n  post_form_value.nonce  = global_config.nonce;\n  post_form_value.ad_campaign = global_config.ad_campaign;\n\n  // Disable the form so people can't resubmit\n  toggleDisable($(petition_form_element).find('*'));\n  toggleDisable($('.btn-submit'));\n\n  // Do a ajax call to the wp_admin admin_ajax.php,\n  // which triggers processing function in the petition block\n  $.ajax({\n    type:    'POST',\n    url:     global_config.ajaxUrl,\n    data:    post_form_value,\n    success: function(data) {\n      // eslint-disable-next-line no-console\n      console.log('^-^');\n\n      const {phone, consent} = post_form_value;\n      let optin = ('on' === consent);\n      let phoneFilled = ('' !== phone);\n      let phonetmp = data['data']['phoneresult'];\n      let phoneResult = (false === phonetmp || true === phonetmp) ? phonetmp : null;\n\n      let mailtmp = data['data']['mailresult'];\n      let mailResult = (false === mailtmp || true === mailtmp) ? mailtmp : null;\n\n      // Send conversion event to the GTM\n      if (typeof dataLayer !== 'undefined') {\n        // New conversion object\n        dataLayer.push(\n          {\n            'event': 'RegisterComplete',\n            'campaign': global_config.analytics_campaign,\n            'action': 'verkiezing',\n            'emailKnown': mailResult,\n            'telKnown': phoneResult,\n            'telFilled': phoneFilled,\n            'optin': optin,\n          });\n\n        dataLayer.push({\n          'event': 'petitiebutton',\n          'conv_campaign': global_config.analytics_campaign,\n          'conv_action': 'verkiezing',\n          'conv_label': 'registreer'\n        });\n\n        // if consent was given by entering phonenumber\n        if (phoneFilled) {\n          // Send conversion event to the GTM\n          dataLayer.push({\n            'event': 'petitiebutton',\n            'conv_campaign': global_config.analytics_campaign,\n            'conv_action': 'telnr',\n            'conv_label': 'Ja'\n          });\n          // If an ad campaign is run by an external company fire the conversiontracking\n          // if (global_config.ad_campaign === 'SB') {\n          //   fbq('track', 'Lead');\n          //   // if it is run by social blue, also deduplicate\n          //   socialBlueDeDuplicate(post_form_value['mail'], data['data']['phone'], global_config.apref);\n          // } else if (global_config.ad_campaign === 'JA') {\n          //   fbq('track', global_config.jalt_track);\n          // }\n        } else {\n          dataLayer.push({\n            'event': 'petitiebutton',\n            'conv_campaign': global_config.analytics_campaign,\n            'conv_action': 'telnr',\n            'conv_label': 'Nee'\n          });\n        }\n      }\n\n      // cardflip the card, positionattribute flips to make sure no problems arises with different lengths of the front and back of the card, finally hide the front\n      cardflip(petition_form_element);\n      let totalVotes = $('#counter_total').data('num');\n      if (!Number(global_config.hideresults) && totalVotes >= global_config.counter_min) {\n        showCounter();\n      }\n\n\n\n      // Bedankt melding verbergen na sluiten van modal window?\n      $('#electionModal').on('hidden.bs.modal', function () {\n        $($('.gpnl-petition-thank')[0]).hide();\n      });\n      let clangct=getUrlVars()['clangct'];\n      if(clangct != undefined){clang.conversion.track();}\n    },\n    error: function(){\n      // If the backend sends an error, hide the thank element and show an error urging to try again\n      // eslint-disable-next-line no-console\n      console.log('o_o');\n      var cardback = $(petition_form_element.parentNode.nextElementSibling);\n      cardback.find('*').hide('');\n      cardback.append('<p>Sorry, er gaat momenteel iets fout, probeer het nu of later opnieuw.</p>');\n      cardback.append(\n        '<a href=\\''+window.location.href +'\\' class=\"btn btn-primary btn-block\"' +\n        '\">Probeer opnieuw</a>');\n      cardflip(petition_form_element);\n    }\n  });\n\n\n});\n\n// Get the key+value from the input fields in the form\nfunction getFormObj(el) {\n  var formObj = {};\n  var inputs = $(el).serializeArray();\n  $.each(inputs, function (i, input) {\n    formObj[input.name] = input.value;\n  });\n  return formObj;\n}\n\n// Toggle the disabled state on form elements\nfunction toggleDisable(el) {\n  el.prop('disabled', !el.prop('disabled'));\n\n}\n\n// toggle the flipped class for the card parent\nfunction cardflip(el) {\n  let element = $(el);\n  let parent =  el.parentNode;\n  let card = $(el.parentNode.parentNode);\n\n  // first hide the signing button\n  $('.btn-submit').toggle();\n  $(element.find('.policies')).toggle();\n  // then cardflip the position attribute on the front and back of the card to support different lengths front and back\n  $(parent.nextElementSibling).css( 'position', flip_positionattribute(parent.nextElementSibling));\n  $(parent).css( 'position', flip_positionattribute(parent));\n  // then cardflip the card\n  card.toggleClass('flipped');\n\n  // after animation hide the front\n  card.one('webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend',\n    function() {\n      $(parent).toggle();\n      card.off('webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend');\n    });\n\n}\n\nfunction flip_positionattribute (el){\n  return $(el).css('position') === 'absolute' ? 'relative' : 'absolute';\n}\n\n/* eslint-disable */\nfunction fireShareEvent (platform){\n  if (typeof dataLayer !== 'undefined') {\n    let global_config = window['election_object'];\n    dataLayer.push({\n      'event'         :'petitiebutton',\n      'conv_campaign' :global_config.analytics_campaign,\n      'conv_action'   :'verkiezing',\n      'conv_label'    :'share_' + platform});\n  }\n  else{\n    console.log('GTM not defined?');\n  }\n}\n/* eslint-enable */\n\n/* eslint-disable */\n// Send the supporter data to for deduplication\nfunction socialBlueDeDuplicate(email, phone, apref) {\n  var apHost = ('https:' == document.location.protocol ? 'https://secure.event.' : 'http://www.') + 'affiliatepartners.com';\n  var apSrc = '/js/ApConversionPixelV1.1.js';\n\n  _apOrderValue = 0;\n  _apOrderNumber = 'email=' + email + '-telefoonnumer=' + phone;\n  _apRef = apref;\n\n  try {\n    $('body').append(unescape('%3Cscript src=\\'' + apHost + apSrc + '\\' type=\\'text/javascript\\'%3E%3C/script%3E'));\n  } catch (err) {\n    var script = document.createElement('script');\n    script.type = 'text/javascript';\n    script.src = apHost + apSrc;\n    document.getElementsByTagName('head')[0].appendChild(script);\n  }\n}\n/* eslint-enable */\n\n// REFACTOR IE11 doesn't support UrlSearchParams, so custom UrlParam function.\n// \tConsider polyfilling it now? or wait until we drop IE11 support and switch then?\nfunction getUrlVars(){\n  var vars = [],\n    hash;\n  var uri = window.location.href.split('#')[0];\n  var hashes = uri.slice(window.location.href.indexOf('?') + 1).split('&');\n  for(var i = 0; i < hashes.length; i++){\n    hash = hashes[i].split('=');\n    vars.push(hash[0]);\n    vars[hash[0]] = hash[1];\n  }\n  return vars;\n}\n\n// TODO add language preference detection for better formatting of numbers\nfunction showCounter(){\n  let modal = $('#electionModal');\n  let totalVotes = $('#counter_total').data('num');\n  let numOptions = modal.data('num');\n  let modalCounter= modal.find('.counter');\n  let modalCounterId = modalCounter.data('counter');\n\n  // Show the counters on the cards\n  for (let i = 1; i <= numOptions; i++) {\n    let counter_config = window['election_object_' + i];\n    let num_responses = counter_config.count;\n    let counter = $('[data-counter=\"'+i+'\"]');\n    let perc_slider = Math.round(100 *(num_responses / totalVotes));\n    counter.show();\n    counter.find('.counter__slider').animate({width: perc_slider+'%', opacity: 1}, 2000, 'easeInOutCubic');\n    counter.find('.counter__gettext').html(perc_slider + '% van de stemmen');\n    counter.find('.counter__text').fadeIn(2000);\n\n    // When processing data which is the same as the modal, also inject it there\n    if (i === modalCounterId) {\n      modalCounter.show();\n      modalCounter.find('.counter__slider').animate({width: perc_slider+'%', opacity: 1}, 2000, 'easeInOutCubic');\n      modalCounter.find('.counter__gettext').html(perc_slider + '% van de stemmen');\n      modalCounter.find('.counter__text').fadeIn(2000);\n    }\n  }\n}\n\n// soap request naar charibase\nfunction prefillByGuid(type, form) {\n  var config = window['election_object'];\n  var xmlhttp = new XMLHttpRequest();\n  var query_id = '';\n  var requestValue = '';\n  // waar gaat het om? Een teller of een prefill?\n  if (type === 'prefill') {\n    query_id = 'GET_FIRST_NAME_EMAIL';\n    requestValue = form.url_cg;\n  } else if (type === 'teller') {\n    query_id = 'CAMP_TTL_PETITIONS';\n    requestValue = form.tellerCode;\n  }\n  xmlhttp.open('POST', 'https://www.mygreenpeace.nl/GPN.WebServices/WIDSService.asmx', true);\n  // build SOAP request\n  var sr = '<' + '?' + 'xml version=\"1.0\" encoding=\"utf-8\"?>' +\n    '<soap:Envelope xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\" xmlns:soap=\"http://schemas.xmlsoap.org/soap/envelope/\">' +\n    '  <soap:Body>' +\n    '    <WatIsDestand xmlns=\"http://www.mygreenpeace.nl/GPN.WebServices/\">' +\n    '      <queryId>' + query_id + '</queryId>' +\n    '      <requestValue>' + requestValue + '</requestValue>' +\n    '    </WatIsDestand>' +\n    '  </soap:Body>' +\n    '</soap:Envelope>';\n\n  xmlhttp.onreadystatechange = function () {\n    if (xmlhttp.readyState === 4 && xmlhttp.status === 200) { // 200 = OK\n      var response = xmlhttp.responseXML.getElementsByTagName('WatIsDestandResult')[0].firstChild.nodeValue;\n      if (response !== '') {\n        var res = response.split('|');\n        // waar gaat het om? Een teller of een prefill\n        if (type === 'prefill') {\n          var naam = res[0];\n          $(form).find('input[name=\\'name\\']').val(naam);\n          var email = res[1];\n          $(form).find('input[name=\\'mail\\']').val(email);\n        } else if (type === 'teller') {\n          if (Number(response) >= config.counter_min) {\n            if (form.type === 'total'){\n              $('#counter_total').data('num', response);\n              $('#counter_total').text(response + ' mensen hebben al gestemd.');\n            }\n            else {\n              form.config.count = response;\n            }\n          }\n        }\n      }\n    }\n  };\n  // Send the POST request\n  xmlhttp.setRequestHeader('Content-Type', 'text/xml');\n  xmlhttp.setRequestHeader('SOAPAction', 'http://www.mygreenpeace.nl/GPN.WebServices/WatIsDestand');\n  xmlhttp.send(sr);\n  // send request\n}\n"]}