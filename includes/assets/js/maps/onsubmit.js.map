{"version":3,"sources":["onsubmit.js"],"names":["getFormObj","el","formObj","inputs","toggleDisable","each","prop","input","name","value","card","parentNode","$","parent","element","toggleClass","find","toggle","nextElementSibling","css","flip_positionattribute","one","dataLayer","form_config","platform","fireShareEvent","form_id","push","event","conv_campaign","window","analytics_campaign","conv_action","ga_action","conv_label","socialBlueDeDuplicate","email","_apOrderValue","script","createElement","apref","document","location","protocol","_apOrderNumber","phone","_apRef","append","unescape","apHost","apSrc","err","getUrlVars","type","src","split","appendChild","hash","vars","hashes","href","slice","indexOf","i","length","on","petition_form_element","this","post_form_value","action","nonce","ad_campaign","url","data","ajaxUrl","success","console","consent","optin","phoneFilled","phonetmp","phoneResult","mailResult","mailtmp","emailKnown","telKnown","telFilled","fbq","jalt_track","cardflip","undefined","clang","conversion","track","cardback","log","hide"],"mappings":"aAwGA,SAASA,WAAWC,GAClB,IAAIC,EAAU,GAShBC,EAASC,EAAAA,GAAAA,iBAJP,OAKAH,EAAEI,KAAFF,EAAQ,SAAgBG,EAAHC,GAIvBL,EAAAK,EAAAC,MAAAD,EAAAE,QATSP,EAaP,SAAIQ,cAAYC,GARhBV,EAAGK,KAAK,YAAaL,EAAGK,KAAK,aAe7BM,SAAEC,SAAaZ,GATf,IAAIa,EAAUF,EAAEX,GAWZY,EAACE,EAAYJ,WATbD,EAAOE,EAAEX,EAAGU,WAAWA,YAevBD,EAAAA,EAAAM,KAAS,aAAAC,SACVL,EAJHE,EAAAE,KAAA,cAAAC,SANAL,EAAEC,EAAOK,oBAAoBC,IAAK,WAAYC,uBAAuBP,EAAOK,qBAc9EN,EAAAC,GAASO,IAAAA,WAAAA,uBAA2BP,IAEnCH,EAAAK,YAAA,WAVCL,EAAKW,IAAI,kFAaX,WACMT,EAAAC,GAAOS,SACTZ,EAAIa,IAAAA,qFAKF,SAAAH,uBAA4BI,GAJf,MAAf,aAAAZ,EAAAX,GAAAkB,IAAA,YAAA,WAAA,WASH,SAAAM,eAAAD,EAAAE,GACD,GAAA,oBAAAJ,UAAA,CAXI,IAAIC,EAAc,wBAA0BG,EAahDJ,UAAAK,KAAA,CACAC,MAAA,gBAXMC,cAAiBC,OAAOP,GAAaQ,mBACrCC,YAAiBF,OAAOP,GAAaU,UAW3CC,WAASC,SAAsBC,SAI7BC,QAAAA,IAAa,oBAOX,SAAIC,sBAAkBC,EAAAA,EAAcC,GACpCF,IAAAA,GAAA,UAAcG,SAAdC,SAAAC,SAAA,wBAAA,eAAA,wBACAL,EAAA,+BAEDD,cAAA,EACFO,eAAA,SAAAR,EAAA,kBAAAS,EACDC,OAAAN,EAGA,IAXI5B,EAAE,QAAQmC,OAAOC,SAAS,kBAAqBC,EAASC,EAAQ,6CAChE,MAAOC,GAWX,IAAAb,EAASc,SAAYb,cAAA,UACnBD,EAAQe,KAAR,kBAAAf,EAAAgB,IAAAL,EAAAC,EAEAT,SAAUX,qBAAqByB,QAArB,GAAAC,YAAVlB,IAMC,SAAAc,aAJD,IAJA,IASAK,EATIC,EAAO,GAGPC,EAOL7B,OAAAY,SAAAkB,KAAAL,MAAA,KAAA,GAPkBM,MAAM/B,OAAOY,SAASkB,KAAKE,QAAQ,KAAO,GAAGP,MAAM,KAC5DQ,EAAI,EAAGA,EAAIJ,EAAOK,OAAQD,IAChCN,EAAOE,EAAOI,GAAGR,MAAM,KACvBG,EAAK/B,KAAK8B,EAAK,IACfC,EAAKD,EAAK,IAAMA,EAAK,GAEvB,OAAOC,EApMT9C,EAAE,sBAAsBqD,GAAG,SAAU,WACnC,IAAIC,EAAwBC,KAAxBD,EAAAA,WAD2CA,GAI3C3C,EAAc,wBAA0B6C,EAAe,QAA3DA,EAAeC,OAAG,wBAElBD,EAAgBC,MAASvC,OAAAP,GAAA+C,MACzBF,EAAgBE,YAAexC,OAACP,GAAhCgD,YAIAnE,cAAcQ,EAAEsD,GAAuBlD,KAAK,MAK1CqC,EAAAA,KAAI,CACJmB,KAAS1C,OACT2C,IAASL,OAAAA,GAHJM,QAILC,KAASP,EACPO,QAAA,SAAAF,GADsBG,QAGf/B,IAAkBuB,OAFzB,IAEcS,EAAWT,EAAXS,MACVC,EAAS,OADYV,EAAAA,QAErBW,EAAe,KAAOlC,EACtBmC,EAAWP,EAAI,KAAJA,YACXQ,GAAe,IAAUD,IAAY,IAASA,EAAYA,EAAW,KAGrEE,EAAUT,EAAI,KAAJ,WAAVS,GAAc,IAAUC,IAAW,IAASA,EAAWA,EAAU,KAMjE,oBADO7D,YAGLA,UAAAK,KACA,CACAC,MAAcmD,mBACdK,WAAcN,EAGlBO,SAAAJ,EAJIK,UAAcP,EAKlBzD,MAAewD,IAIbxD,UAAAK,KAAA,CAJFC,MAOA,gBALEC,cAAkBC,OAAOP,GAAaQ,mBAMxCC,YAAiBF,OAAAP,GAAAU,UACfC,WAAA,eAIE6C,GAFazD,UAMfK,KAAA,CALEC,MAAiB,gBAMnBC,cAAWN,OAAagD,GAAgBxC,mBACtCwD,YAAa,QAJbrD,WAAiB,OAQgBsD,OAAjCD,OAAIhE,GAAgBA,aACrBgE,IAAA,QAAA,QAGDpD,sBAAAiC,EAAA,KAAAK,EAAA,KAAA,eAAA3C,OAAAP,GAAAiB,QACe,OAALb,OAAKJ,GAAAgD,aACbgB,IAAA,QAAiBzD,OAAAP,GADJiE,aAMhBlE,UAAAK,KAAA,CAKHC,MAAA,gBATMC,cAAkBC,OAAOP,GAAaQ,mBACtCC,YAAiB,QASvByD,WAASvB,SAKTuB,SAAAvB,GAEYwB,MADZtC,aAAA,SACAuC,MAAAC,WAAAC,SAEAC,MAAAA,WAKAL,QAAQM,IAAC7B,OACV,IAAA4B,EAAAlF,EAAAsD,EAAAvD,WAAAO,oBApFH4E,EAAA9E,KAAA,KAAAgF,KAAA,IAwFFF,EAAA/C,OAAA,+EARM+C,EAAS/C,OASf,YAAoB9C,OAAIyC,SAAAkB,KAAA,6DAElBzD,SAASS","file":"../onsubmit.js","sourcesContent":["$('.gpnl-petitionform').on('submit', function () {\n  var petition_form_element = this;\n  // Get the  parameter from the petition form and add the action and CSRF protection\n  var post_form_value = getFormObj(petition_form_element);\n  var form_config = 'petition_form_object_' + post_form_value['form_id'];\n\n  post_form_value.action = 'petition_form_process';\n  post_form_value.nonce  = window[form_config].nonce;\n  post_form_value.ad_campaign = window[form_config].ad_campaign;\n\n  // Disable the form so people can't resubmit\n  toggleDisable($(petition_form_element).find('*'));\n\n  // Do a ajax call to the wp_admin admin_ajax.php,\n  // which triggers processing function in the petition block\n  $.ajax({\n    type:    'POST',\n    url:     window[form_config].ajaxUrl,\n    data:    post_form_value,\n    success: function(data) {\n      // eslint-disable-next-line no-console\n      console.log('^-^');\n      const {phone, consent} = post_form_value;\n      let optin = ('on' === consent);\n      let phoneFilled = ('' !== phone);\n      let phonetmp = data['data']['phoneresult'];\n      let phoneResult = (false === phonetmp || true === phonetmp) ? phonetmp : null;\n\n      let mailtmp = data['data']['mailresult'];\n      let mailResult = (false === mailtmp || true === mailtmp) ? mailtmp : null;\n\n      // Send conversion event to the GTM\n      if (typeof dataLayer !== 'undefined') {\n        // New conversion object\n        dataLayer.push(\n          {\n            'event':      'RegisterComplete',\n            'emailKnown': mailResult,\n            'telKnown':   phoneResult,\n            'telFilled':  phoneFilled,\n            'optin':      optin,\n          });\n\n        // Temp old stuff to compare\n        dataLayer.push({\n          'event'         :'petitiebutton',\n          'conv_campaign' : window[form_config].analytics_campaign,\n          'conv_action'   : window[form_config].ga_action,\n          'conv_label'    :'registreer'\n        });\n\n        // if consent was given by entering phonenumber\n        if (phoneFilled) {\n          // Send conversion event to the GTM\n          // Temp old stuff to compare\n          dataLayer.push({\n            'event'         :'petitiebutton',\n            'conv_campaign' : window[form_config].analytics_campaign,\n            'conv_action'   :'telnr',\n            'conv_label'    :'Ja',\n          });\n          // If an ad campaign is run by an external company fire the conversiontracking\n          if (window[form_config].ad_campaign === 'SB') {\n            fbq('track', 'Lead');\n            // if it is run by social blue, also deduplicate\n            socialBlueDeDuplicate(post_form_value['mail'], data['data']['phonesanitized'], window[form_config].apref);\n          } else if (window[form_config].ad_campaign === 'JA') {\n            fbq('track', window[form_config].jalt_track);\n          }\n        }\n        else{\n          // Temp old stuff to compare\n          dataLayer.push({\n            'event'         :'petitiebutton',\n            'conv_campaign' : window[form_config].analytics_campaign,\n            'conv_action'   :'telnr',\n            'conv_label'    :'Nee',\n          });\n        }\n      }\n\n\n\n      // cardflip the card, positionattribute flips to make sure no problems arises with different lengths of the front and back of the card, finally hide the front\n      cardflip(petition_form_element);\n      let clangct=getUrlVars()['clangct'];\n      if(clangct != undefined){clang.conversion.track();}\n    },\n    error: function(){\n      // If the backend sends an error, hide the thank element and show an error urging to try again\n      // eslint-disable-next-line no-console\n      console.log('o_o');\n      var cardback = $(petition_form_element.parentNode.nextElementSibling);\n      cardback.find('*').hide('');\n      cardback.append('<p>Sorry, er gaat momenteel iets fout, probeer het nu of later opnieuw.</p>');\n      cardback.append(\n        '<a href=\\''+window.location.href +'\\' class=\"btn btn-primary btn-block\"' +\n        '\">Probeer opnieuw</a>');\n      cardflip(petition_form_element);\n    }\n  });\n});\n\n// Get the key+value from the input fields in the form\nfunction getFormObj(el) {\n  var formObj = {};\n  var inputs = $(el).serializeArray();\n  $.each(inputs, function (i, input) {\n    formObj[input.name] = input.value;\n  });\n  return formObj;\n}\n\n// Toggle the disabled state on form elements\nfunction toggleDisable(el) {\n  el.prop('disabled', !el.prop('disabled'));\n\n}\n\n// toggle the flipped class for the card parent\nfunction cardflip(el) {\n  let element = $(el);\n  let parent =  el.parentNode;\n  let card = $(el.parentNode.parentNode);\n\n  // first hide the signing button\n  $(element.find('.signBtn')).toggle();\n  $(element.find('.policies')).toggle();\n  // then cardflip the position attribute on the front and back of the card to support different lengths front and back\n  $(parent.nextElementSibling).css( 'position', flip_positionattribute(parent.nextElementSibling));\n  $(parent).css( 'position', flip_positionattribute(parent));\n  // then cardflip the card\n  card.toggleClass('flipped');\n\n  // after animation hide the front\n  card.one('webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend',\n    function() {\n      $(parent).toggle();\n      card.off('webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend');\n    });\n\n}\n\nfunction flip_positionattribute (el){\n  return $(el).css('position') === 'absolute' ? 'relative' : 'absolute';\n}\n\n/* eslint-disable */\nfunction fireShareEvent (platform, form_id){\n  if (typeof dataLayer !== 'undefined') {\n    let form_config = 'petition_form_object_' + form_id;\n    dataLayer.push({\n      'event'         :'petitiebutton',\n      'conv_campaign' :window[form_config].analytics_campaign,\n      'conv_action'   :window[form_config].ga_action,\n      'conv_label'    :'share_' + platform});\n  }\n  else{\n    console.log('GTM not defined?');\n  }\n}\n/* eslint-enable */\n\n/* eslint-disable */\n// Send the supporter data to for deduplication\nfunction socialBlueDeDuplicate(email, phone, apref) {\n  var apHost = ('https:' == document.location.protocol ? 'https://secure.event.' : 'http://www.') + 'affiliatepartners.com';\n  var apSrc = '/js/ApConversionPixelV1.1.js';\n\n  _apOrderValue = 0;\n  _apOrderNumber = 'email=' + email + '-telefoonnumer=' + phone;\n  _apRef = apref;\n\n  try {\n    $('body').append(unescape('%3Cscript src=\\'' + apHost + apSrc + '\\' type=\\'text/javascript\\'%3E%3C/script%3E'));\n  } catch (err) {\n    var script = document.createElement('script');\n    script.type = 'text/javascript';\n    script.src = apHost + apSrc;\n    document.getElementsByTagName('head')[0].appendChild(script);\n  }\n}\n/* eslint-enable */\n\n// REFACTOR IE11 doesn't support UrlSearchParams, so custom UrlParam function.\n// \tConsider polyfilling it now? or wait until we drop IE11 support and switch then?\nfunction getUrlVars(){\n  var vars = [],\n    hash;\n  var uri = window.location.href.split('#')[0];\n  var hashes = uri.slice(window.location.href.indexOf('?') + 1).split('&');\n  for(var i = 0; i < hashes.length; i++){\n    hash = hashes[i].split('=');\n    vars.push(hash[0]);\n    vars[hash[0]] = hash[1];\n  }\n  return vars;\n}\n"]}